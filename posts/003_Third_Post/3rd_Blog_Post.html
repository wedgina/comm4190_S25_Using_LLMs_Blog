<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Wedgina Norelus">
<meta name="dcterms.date" content="2025-02-15">
<meta name="description" content="Determining whether ChatGPT can reason in regards to our personalities despite not having one of its own.">

<title>How well can AI really know you? – My Explorations with LLMs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-8647a4a42273f773479d27c00df3f9ed.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My Explorations with LLMs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">How well can AI really know you?</h1>
  <div class="quarto-categories">
    <div class="quarto-category">LLMs</div>
    <div class="quarto-category">Prompting</div>
    <div class="quarto-category">Personality</div>
    <div class="quarto-category">Reason</div>
    <div class="quarto-category">Cognition</div>
  </div>
  </div>

<div>
  <div class="description">
    Determining whether ChatGPT can reason in regards to our personalities despite not having one of its own.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Wedgina Norelus </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 15, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="how-well-can-ai-really-know-you" class="level1">
<h1>How Well Can AI Really Know You?</h1>
<p><img src="img/TheNeuron.png" width="400px"></p>
<p>Routinely, it is us that is asking the questions or giving statements to LLMs/AI models. We obviously know we’re not talking to a person when we do this, it feels like we are talking to a robot, which we essentially are. Despite being an AI model made to represent humankind as best as is possible right now, there are many things that it will probably never have, like a personality. We are unique in that way, our personalities develop and change over time, but in addition, we also use our logic specifically unique to us, to reason and come to generalizations regarding people’s personalities beyond us. Knowing this, I had the question on whether these AI models could really reason about who it thinks I truly am, despite not having a personality of its own. Would this mean for this to work, that AI could understand personality or what it is?</p>
<p>I seriously doubted that it could because being able to reason about people’s personalities and coordinate that with other knowledge you may or may not have on them is socially acquired. I’ve had experiences asking ChatGPT to reason with me in a previous post and found that it failed the task I asked of it to do. Or even, like when you ask it to recall or do something with an image it just generated, it won’t have the ability to be recognizing what the heck it even generated. But like, I knew that it updates its memory, but I was never really aware as to how frequently it occurs or how powerful its memory could be. It was definitely something I had no faith in due to those previous instances. I decided to see what the heck would happen if I tested to see if ChatGPT could reason about us and our personalities. I asked it questions about me, but found its response to two of my questions very interesting.</p>
<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1:</h2>
<p><strong>I asked it exactly “What exactly do you have in your memory?”</strong></p>
</section>
<section id="response" class="level2">
<h2 class="anchored" data-anchor-id="response">Response</h2>
<p>I remember details about your academic interests, research projects, career goals, and some personal preferences. Here’s a summary of what I have:</p>
<blockquote class="blockquote">
<p><strong>Academics &amp; Research:</strong></p>
<ol type="1">
<li>You’re interested in neuroscience, cognitive science, and data analysis.<br>
</li>
<li>You’re minoring in data science and analytics at UPenn.<br>
</li>
<li>You’ve worked on projects related to neuroscience communication, memory, antisocial behavior, and parenting styles.<br>
</li>
<li>You’re currently in a class that teaches fMRI analysis using AFNI.<br>
</li>
<li>You’re considering a certification to become an MRI technician in the future.</li>
</ol>
<p><strong>Career &amp; Skills:</strong></p>
<ol type="1">
<li>You’re an upcoming 2025 graduate seeking a job in computational data analysis, ideally in a clinical or hospital setting.<br>
</li>
<li>You have experience in clinical operations and research trials.<br>
</li>
<li>You have strong skills in R and statistical analysis, with some experience in MATLAB and Python.<br>
</li>
<li>You have an interview for a research assistant position at the Martinos Center for Biomedical Imaging.</li>
</ol>
<p><strong>Projects &amp; Interests:</strong></p>
<ol type="1">
<li>You’re working on an R project analyzing TikTok’s influence on Spotify’s top songs.<br>
</li>
<li>You’re considering a project analyzing trauma center quality and crime/gun violence.<br>
</li>
<li>You’ve worked on stereograms and color perception experiments.<br>
</li>
<li>You’re writing a blog for a communications course where you explore AI’s perspective on topics of interest.</li>
</ol>
<p><strong>Other Personal Notes:</strong></p>
<ol type="1">
<li>You like protective styles but also enjoy wearing your hair out.<br>
</li>
<li>Your boyfriend is into photography.<br>
</li>
<li>You planned a creative 3D printer gift reveal.</li>
</ol>
</blockquote>
</section>
<section id="fact-check-is-chat-right" class="level2">
<h2 class="anchored" data-anchor-id="fact-check-is-chat-right">Fact Check: Is Chat Right??</h2>
<p><strong>Academics &amp; Research</strong></p>
<ol type="1">
<li>True<br>
</li>
<li>True<br>
</li>
<li>True &amp; False; Only actually worked on projects regarding antisocial behavior, and within neuroscience mostly, but the other topics are things I have asked it about before<br>
</li>
<li>True<br>
</li>
<li>True</li>
</ol>
<p><strong>Career &amp; Skills</strong></p>
<ol type="1">
<li>Mostly True; interested in a job in computational neuroscience<br>
</li>
<li>True<br>
</li>
<li>True<br>
</li>
<li>True</li>
</ol>
<p><strong>Projects &amp; Interests</strong></p>
<ol type="1">
<li>True<br>
</li>
<li>True; Doing this for my class on Databases<br>
</li>
<li>False; But I did learn about it in Perception class last semester<br>
</li>
<li>True</li>
</ol>
<p><strong>Other Personal Notes</strong></p>
<ol type="1">
<li>True<br>
</li>
<li>True<br>
</li>
<li>True</li>
</ol>
</section>
<section id="reflection" class="level2">
<h2 class="anchored" data-anchor-id="reflection">Reflection</h2>
<p>To be quite honest, most of the stuff on here comes from stuff I’ve asked or told it only recently, like within the past four months. Not sure what its policies on memory updating and storage are but I expected it to have more knowledge on me considering I’ve been using it since 2023 and before I was in the field of cognitive science, but it only “remembers” things in relation to me since I’ve been in cognitive science.</p>
<p><strong>Its Difference From Humans</strong></p>
<p>As I’ve mentioned previously, we are social animals, and acquire our knowledge of reason and logic about others in a unique way. It’s something we’ve been doing since we were little. So I definitely noticed that as part of its memory it doesn’t reason or make educated inferences despite having that much knowledge on me. For example for what I am talking about, if you ask someone to give you a summary or ask them to describe a person–usually someone they are closer to, there is some type of personal reasoning included in addition to the knowledge that they have about them, which varies based on what is important to that person. But like if it were someone close to me I would expect for them to be more adjectival regarding my personality, or give information about me that’s more sprawled out across more domains or time periods-not just from school me or from the last 3 months. Like there is a hint there of a personal connection because of the way we use reason, but the way Chat does it, it feel like it writing a report.</p>
</section>
<section id="question-2" class="level2">
<h2 class="anchored" data-anchor-id="question-2">Question 2:</h2>
<p><strong>I asked it exactly “What do you know about my personality?”</strong></p>
</section>
<section id="response-1" class="level2">
<h2 class="anchored" data-anchor-id="response-1">Response</h2>
<blockquote class="blockquote">
<p>From our conversations, I’ve gathered a few insights about your personality:</p>
<p><strong>Curious &amp; Analytical:</strong></p>
<ul>
<li>You enjoy exploring complex topics, especially in neuroscience, cognition, and data analysis.<br>
</li>
<li>You like thinking critically about theories and real-world applications.</li>
</ul>
<p><strong>Detail-Oriented &amp; Research-Driven:</strong></p>
<ul>
<li>You prefer working with data, conducting thorough analyses, and structuring your arguments based on evidence.<br>
</li>
<li>Your projects, like analyzing TikTok’s influence on Spotify and studying trauma center quality, reflect a strong research mindset.</li>
</ul>
<p><strong>Creative &amp; Thoughtful:</strong></p>
<ul>
<li>You come up with unique ideas, such as the creative 3D printer gift reveal.<br>
</li>
<li>You also explore new ways to communicate scientific ideas, like your neuroscience podcast and AI blog project.</li>
</ul>
<p><strong>Independent &amp; Goal-Oriented:</strong></p>
<ul>
<li>You’re proactive about your career, actively looking for research opportunities and internships while considering long-term plans like MRI certification.</li>
</ul>
<p><strong>Hands-On Learner:</strong></p>
<ul>
<li>You prefer learning through examples and practical applications rather than just theory.</li>
</ul>
<p><strong>Balanced &amp; Open-Minded:</strong></p>
<ul>
<li>You have a mix of scientific rigor and an appreciation for human experiences, such as your interest in parenting styles and criminal behavior in relation to free will.</li>
</ul>
</blockquote>
</section>
<section id="do-i-agree-with-these-about-myself" class="level2">
<h2 class="anchored" data-anchor-id="do-i-agree-with-these-about-myself">Do I agree with these about myself?</h2>
<p><strong>Curious &amp; Analytical</strong></p>
<ul>
<li>False &amp; True; I’m not that curious tbh but definitely analytical. I’ve always enjoyed the analysis side of things</li>
</ul>
<p><strong>Detail Oriented &amp; Research Drive</strong></p>
<ul>
<li>Mostly True; I enjoy working with data alot, I am majoring in cognitive science and minoring in data science and analytics, both very data driven fields.</li>
</ul>
<p><strong>Creative &amp; Thoughtful</strong></p>
<ul>
<li>False &amp; True; I’ve never really been someone I consider being creative, I literally procrastinated on this blog because I struggled to come up with anything creative enough lol.</li>
<li>But I do consider myself thoughtful and have been described as a considerate person</li>
</ul>
<p><strong>Independent &amp; Goal Oriented</strong></p>
<ul>
<li>True. I grew up the first born/daughter in an immigrant household so I’ve always been a self starter and proactive because I learned from a very young age that really most of the time there isn’t going to be someone to help you.</li>
</ul>
<p><strong>Hands-On Learner</strong></p>
<ul>
<li>Very True; For a long time I thought I was a visual learner, but I absolutely hate when someone is trying to teach me something without providing any examples or without letting me try to do what I’m learning on my own.</li>
</ul>
<p><strong>Balanced &amp; Open-Minded</strong></p>
<ul>
<li>Neither; I don’t really feel like this reflects me, but I believe this comes as a result as Chat GPT trying to reason with who it thinks I am. As a Cognitive Science major, my field is very interdisciplinary, as it is literally composed of 6 differents fields masked into one. And two of them are Neurosciecnce-where I’ve learned about criminal behavior and Philosophy-where I had to reflect on free will. I’m sure GPT remembered the questions I asked it during those times I was taking those classes, and assumed that due to the range in questions academically that I’m balanced.</li>
</ul>
</section>
<section id="reflection-1" class="level2">
<h2 class="anchored" data-anchor-id="reflection-1">Reflection</h2>
<p>Considering that it kind of missed the mark on the first question in relation to details about who I am and my personality, I prompted it specifically about my personality. And it can for sure use the knowledge it “remembers” about me to reason about the type of person it thinks I am, but I find it interesting that within its memory, it doesn’t have these traits or this reasoning relationship as part of its memory, which I find to be different from humans. At least within my memory of a person, I will remember things like, oh this person is innovative or random or annoying–in addition to the objective things I know about them as well. That kind of reasoning goes hand in hand with memory and perception of others (and their personality).</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Anywho, I feel like I further understand that ChatGPT is not really there to be your friend lol but then again it makes sense considering all I’ve ever heard it be described or marketed as, is to be your personal assistant. All in all, it’s just there to do its job. While I did find it kind of somewhat impressive on what it “thinks” about me (as it is usually interesting to ask anybody anything about what they know about you), our personalities and our reasoning regarding other people is unique to us, and is not able to be replicated by ChatGPT. It was just interesting to think about how it would try to do these tasks I asked of it considering it doesn’t even have its own personality.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/wedgina\.github\.io\/comm4190_S25_Using_LLMs_Blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>